<!-- LAUNCHER MODAL start -->
	<div id="launcher-modal">
		<div class="launcher-modal-overlay">
			<div id="launcher-scroll-indicator" class="scroll-indicator"></div>
			<i class="fa fa-times launcher-widgets-button"></i>
		</div>
		<div id="launcher-modal-panel">
			<div class="search-box" style="color:#FFF">
				<span name="feed" class="fa fa-feed" title="Лента: новости и статьи" style="border:0;font-size:25px;transform: scale(-1, 1);padding: 5px;margin-top:2px;"></span>
				<span name="gallery" class="fa fa-caret-square-o-right" style="left:30px;font-size:25px;padding: 5px;margin-top: 2px;" title="Галерея: портфолио / наши работы"></span>
				<span name="spotlight" class="fa fa-fire" style="left:0px;font-size:25px;padding: 5px;margin-top: 2px;" title="Центр внимания"></span>
				<span name="contact" class="fa fa-phone" style="left:30px;font-size:25px;padding: 5px;margin-top: 2px;" title="Контакты"></span>
				<span name="info" class="fa fa-info-circle" style="left:30px;font-size:25px;padding: 5px;margin-top: 2px;" title="Корпоративная информация"></span>
				
				<span name="info" class="fa fa-hashtag" style="color:#202020;position:absolute;left:0;top:35px;font-size:25px;padding: 5px;margin-top: 2px;" title="Фильтрация"></span>
				<span name="info" class="fa fa-sort-amount-asc " style="color:#202020;position:absolute;right:0;top:35px;font-size:25px;padding: 5px;margin-top: 2px;" title="Сортировка"></span>
				
				<input id="story" name="story" placeholder="Поиск по сайту..." type="text">
			</div>
		</div>
		<div id="launcher-modal-content"></div>
	</div>
<!-- LAUNCHER MODAL end -->
<!-- LAUNCHER WIDGETS start -->
	<div id="launcher-widgets-panel">
		<i name="contact" class="fa fa-phone launcher-widgets-button"></i>
		<i name="spotlight" class="fa fa-search launcher-widgets-button"></i>
	</div>
<!-- LAUNCHER WIDGETS end -->

<script>
	//LAUNCHER APP
	class appLauncher{
		constructor(obj){
			this.modal = obj;
			this.modal.hide();
		}
		hide(){
			$('body').css('overflow', 'auto');
			this.modal.fadeOut('fast');
			try{
				history.pushState(null, null, location.pathname);
			}catch{}
		}
		update(section){
			$("#preloader").show();
			$('#launcher-modal-content').css('opacity','0');
			history.pushState(null, null, location.pathname+'?'+section);
			$('body').css('overflow', 'hidden');

			$('.mobx-holder').remove();
			let search_area = "сайту";
			switch(section){
				case "gallery":
					search_area = "галерее";
					break;
				case "feed":
					search_area = "ленте";
					break;
			}
			$('#story').attr("placeholder","Поиск по "+search_area);
			$(".search-box span").each(function(i,e){
				$(e).removeClass("red");
			});
			$(".search-box span[name='"+section+"']").addClass("red");

			setTimeout(() => $('#launcher-modal-content').load("/launcher/"+section+".html", function(){
				$('#launcher-modal-content').css('opacity','1');
				$("#preloader").fadeOut(500);
			}), 500);
			
			this.modal.fadeIn('slow');
		}
	}
	//1. INIT
	const launcher = new appLauncher($('#launcher-modal'));
	//2. OPEN
	$(".search-box span").on("click", function(){
		launcher.update($(this).attr('name'));
	});
	$("#launcher-widgets-panel i").on("click", function(){
		launcher.update($(this).attr('name'));
	});
	if (location.search){
		launcher.update(location.search.substr(1));
	}
	//3. CLOSE
	$(".launcher-modal-overlay").on("click", function(){
		launcher.hide();
	});

	//PROGRESS-BAR
	function modalContent_init(recid){
		var modalContent_lastCall,
				modalContent_timeoutId,
				modalContent_interval = 100;
		$("#launcher-modal-content").scroll( function() {
			var modalContent_now = new Date().getTime();
			if (modalContent_lastCall && modalContent_now < (modalContent_lastCall + modalContent_interval) ) {
					clearTimeout(modalContent_timeoutId);
					modalContent_timeoutId = setTimeout(function () {
							modalContent_lastCall = modalContent_now;
							modalContent_setProgressBarWidth(recid);
					}, modalContent_interval - (modalContent_now - modalContent_lastCall) );
			} else {
					modalContent_lastCall = modalContent_now;
					modalContent_setProgressBarWidth(recid);
			}
		});
	}

	function modalContent_setProgressBarWidth(recid) {
		var modalContent_windowScrollTop = $("#launcher-modal-content").scrollTop(),
			modalContent_winHeigh = $("#launcher-modal-content").height(),
			modalContent_docHeight = document.getElementById('launcher-modal-content').scrollHeight,
			modalContent_scrollPercent = (modalContent_windowScrollTop / (modalContent_docHeight-modalContent_winHeigh)) * 100,
			startColor = [0,220,255], //RGB
			endColor = [255,32,73], //RGB
			currentColor = [
				Math.round(startColor[0]+(endColor[0]-startColor[0])/100*modalContent_scrollPercent),
				Math.round(startColor[1]+(endColor[1]-startColor[1])/100*modalContent_scrollPercent),
				Math.round(startColor[2]+(endColor[2]-startColor[2])/100*modalContent_scrollPercent)
			];
		$("#launcher-scroll-indicator").css('width', modalContent_scrollPercent + '%');
  		$("#launcher-scroll-indicator").css('background', "rgb("+currentColor[0]+","+currentColor[1]+","+currentColor[2]+")");
	}

	modalContent_init();
	modalContent_setProgressBarWidth();
</script>